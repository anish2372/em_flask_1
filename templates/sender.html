{% extends "base.html" %}
{% block title %}MQTT Sender for anish{% endblock %}
{% block content %}
<div class="container mt-4">
  <h1>MQTT Sender for anish</h1>
  <div class="mb-3">
    <input type="text" id="message" class="form-control" placeholder="Type message...">
  </div>
  <button class="btn btn-primary" onclick="sendMessage()">Send</button>
  <p class="mt-2">Status: <span id="status">Connecting...</span></p>
</div>

<script src="{{ url_for('static', filename='mqttws31.min.js') }}"></script>
<script>
  // Create MQTT client instance
  const client = new Paho.MQTT.Client("mqtt.eclipseprojects.io", 80, "/mqtt", "sender-" + Math.random());

  client.connect({
    onSuccess: () => {
      document.getElementById("status").innerText = "Connected";
      console.log("Connected");
    },
    onFailure: err => {
      document.getElementById("status").innerText = "Failed";
      console.error(err);
    }
  });

  function sendMessage() {
    const text = document.getElementById("message").value;
    if (!text) return;
    const msg = new Paho.MQTT.Message(text);
    msg.destinationName = "flask/mqtt/chat";
    client.send(msg);
    console.log("Sent:", text);
    document.getElementById("message").value = "";
  }
</script>
{% endblock %}
